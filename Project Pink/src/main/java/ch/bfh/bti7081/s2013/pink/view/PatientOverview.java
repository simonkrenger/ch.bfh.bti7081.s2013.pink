package ch.bfh.bti7081.s2013.pink.view;

import java.text.SimpleDateFormat;

import ch.bfh.bti7081.s2013.pink.model.Patient;
import ch.bfh.bti7081.s2013.pink.model.Session;

import com.vaadin.addon.touchkit.ui.NavigationButton;
import com.vaadin.addon.touchkit.ui.VerticalComponentGroup;
import com.vaadin.ui.ComponentContainer;
import com.vaadin.ui.CustomComponent;
import com.vaadin.ui.HorizontalLayout;
import com.vaadin.ui.Label;
import com.vaadin.ui.VerticalLayout;

/**
 * VIew class to display an overview of the next session/patient.
 * 
 * @author Marco Berger <lostchall@gmail.com>
 */
public class PatientOverview extends CustomComponent {
	private static final long serialVersionUID = -6396971132171425883L;

	private SimpleDateFormat dateFormat = new SimpleDateFormat();

	private Patient patient;
	private Session session;

	/**
	 * The constructor should first build the main layout, set the composition
	 * root and then do any custom initialization.
	 * 
	 * The constructor will not be automatically regenerated by the visual
	 * editor.
	 */
	public PatientOverview(Session session) {
		this.patient = session.getPatient();
		this.session = session;
		setCompositionRoot(buildMainLayout());
	}

	private ComponentContainer buildMainLayout() {
		VerticalComponentGroup box = new VerticalComponentGroup();

		VerticalLayout mainLayout = new VerticalLayout();
		box.addComponent(mainLayout);

		HorizontalLayout nameAndStatus = new HorizontalLayout();
		mainLayout.addComponent(nameAndStatus);
		nameAndStatus.setWidth("100%");

		// Patient information
		Label name = new Label();
		name.setValue(patient.getFirstName() + " " + patient.getName());
		nameAndStatus.addComponent(name);
		nameAndStatus.setExpandRatio(name, 1.0f);

		Label status = new Label(String.valueOf(session.getSessionState()));
		status.setPrimaryStyleName("rightaligned");
		nameAndStatus.addComponent(status);
		nameAndStatus.setExpandRatio(status, 1.0f);

		// Session time information
		HorizontalLayout sessionInfo = new HorizontalLayout();
		mainLayout.addComponent(sessionInfo);
		sessionInfo.setWidth("100%");

		// SessionBegin
		Label sessionBegin = new Label("Session begin:");
		sessionInfo.addComponent(sessionBegin);
		sessionInfo.setExpandRatio(sessionBegin, 1.0f);

		String startTime = dateFormat.format(session.getTimeStart());
		Label sessionBeginTime = new Label(startTime);
		sessionBeginTime.setPrimaryStyleName("rightaligned");
		sessionInfo.addComponent(sessionBeginTime);
		sessionInfo.setExpandRatio(sessionBeginTime, 1.0f);

		// Adds the button to start the patient session
		box.addComponent(new NavigationButton("Show Patient Details",
				new PatientDetailView(patient)));

		// Adds the button to start the patient session
		box.addComponent(new NavigationButton("Show Session", new SessionView(
				session, patient)));

		return box;
	}
}